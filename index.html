<!doctype html>
const li = newsItemTpl.content.cloneNode(true);
const a = li.querySelector('a');
const h3 = li.querySelector('h3');
const timeEl = li.querySelector('span');
const src = li.querySelector('p');
a.href = it.link;
h3.textContent = it.title;
timeEl.textContent = it.pubDate ? timeAgo(it.pubDate) : '';
src.textContent = it.source || new URL(it.link).hostname.replace('www.', '');
newsList.appendChild(li);
}
if (!newsList.children.length) {
newsList.innerHTML = '<li class="text-sm text-gray-500">No articles in this window.</li>';
}
}


async function loadStocks() {
stockList.innerHTML = '<li class="p-2 text-sm text-gray-500">Loading…</li>';
const url = `${API_BASE}/api/stocks?range=${state.stockRange}`;
const r = await fetch(url);
const data = await r.json();
if (!data.ok) {
stockList.innerHTML = `<li class='p-2 text-sm text-red-600'>Error: ${data.error}</li>`;
return;
}
stockList.innerHTML = '';
data.items.forEach((row, i) => {
const li = document.createElement('li');
li.className = 'py-2 flex items-center justify-between';
const sign = row.changePct >= 0 ? '+' : '';
li.innerHTML = `
<div class="flex items-center gap-2">
<span class="w-6 text-xs text-gray-500">${i+1}</span>
<span class="font-semibold">${row.symbol}</span>
</div>
<div class="text-right">
<div class="text-sm">${row.last ? row.last.toFixed ? row.last.toFixed(2) : row.last : '—'}</div>
<div class="text-xs ${row.changePct >= 0 ? 'text-green-600' : 'text-red-600'}">${sign}${row.changePct.toFixed(2)}%</div>
</div>`;
stockList.appendChild(li);
});
stockSource.textContent = `Source: ${data.items?.[0]?.source || '—'} (${data.range})`;
}


// Event wiring
categoryTabs.addEventListener('click', (e) => {
const btn = e.target.closest('button[data-cat]');
if (!btn) return;
state.category = btn.dataset.cat;
setActive(categoryTabs, 'button[data-cat]', 'cat', state.category);
loadNews();
});
timeframeSel.addEventListener('change', () => {
state.since = timeframeSel.value;
loadNews();
});
stockTabs.addEventListener('click', (e) => {
const btn = e.target.closest('button[data-range]');
if (!btn) return;
state.stockRange = btn.dataset.range;
setActive(stockTabs, 'button[data-range]', 'range', state.stockRange);
loadStocks();
});


// Init
setActive(categoryTabs, 'button[data-cat]', 'cat', state.category);
setActive(stockTabs, 'button[data-range]', 'range', state.stockRange);
loadNews();
loadStocks();
</script>
</body>
</html>